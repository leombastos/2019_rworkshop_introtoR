unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location),show.legend = F, size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed), show.legend = F)+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_fill_tableau()
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location),show.legend = F, size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location), show.legend = F)+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_fill_tableau()
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_fill_tableau()
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_fill_tableau()+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_fill_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_bw()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
library(ggthemes)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_dark()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_economist()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_pander()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized_2()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2, alpha=.6)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location))+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized_2()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2, alpha=.6)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location), size=1.5)+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized_2()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2, alpha=.6)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location), size=1)+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized_2()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
soyk_reg_all
soyk_reg_all$Anova
# Loading packages (everytime you open R)
library(tidyverse) # plotting and wrangling functions
library(readxl) # to read data from an excel file
library(lme4) # for mixed models
library(car) # Anova
library(broom.mixed) # model diagnostics
library(emmeans) # Anova means
library(multcomp) # pairwise comparisons
library(ggthemes) # ggplot customization
soyk_w<- read_excel("../data/SoybeanWorkshopProcessed.xlsx", sheet=1)
# Checking first rows
soyk_w
ggplot(soyk_w, aes(x=Krate_kgha, y=K_pct))+
geom_point(aes(color=Location))+
geom_smooth(method="lm")+
facet_grid(.~Location)
# Creating Krate as categorical (factor)
soyk_w<- soyk_w %>%
mutate(fKrate_kgha=factor(Krate_kgha),
fRep=factor(Rep),
Location=factor(Location)) %>%
filter(Location!="W1" | fRep!="1")
soyk_w
# Extracting only one location (S1)
soyk_w_S1<- soyk_w %>%
filter(Location=="S1")
soyk_w_S1
options(contrasts = c("contr.sum", "contr.poly"))
soyk_reg_S1<- lmer(K_pct ~ (1|fRep) + Krate_kgha,
data=soyk_w_S1)
soyk_reg_S1<- lmer(K_pct ~ (1|fRep) +
Krate_kgha,
data=soyk_w_S1)
summary(soyk_reg_S1)
Anova(soyk_reg_S1, type=3)
Anova(soyk_reg_S1, type=3)
soyk_reg_aug_S1<-augment(soyk_reg_S1)
soyk_reg_aug_S1$.stdresid<- resid(soyk_reg_S1, type="pearson", scaled=T)
ggplot(soyk_reg_aug_S1, aes(x=.fitted, y=.stdresid))+
geom_point(aes(color=fRep))+
geom_hline(yintercept = c(-3,0,3), color="orange")+
geom_smooth()
ggplot(soyk_reg_aug_S1, aes(sample=.stdresid))+
stat_qq()+
stat_qq_line()
randeff_Rep_A1<- ranef(soyk_reg_S1)[[1]]
ggplot(randeff_Rep_A1, aes(sample=`(Intercept)`))+
stat_qq()+
stat_qq_line()
soyk_reg_means_S1<- emmeans(soyk_reg_S1,
~Krate_kgha)
soyk_reg_means_S1
soyk_reg_aug_S1 %>%
ggplot(aes(y=.fixed, x=Krate_kgha))+
geom_line()+
geom_point(aes(y=K_pct))
soyk_reg_all <- soyk_w %>%
group_by(Location) %>%
nest() %>%
# Fitting RCBD model
mutate(mod=map(data,
~lmer(K_pct ~
(1|fRep) +
Krate_kgha,
data=.x))) %>%
# Anova
mutate(Anova=map(mod,
~Anova(.x, type=3))) %>%
# Augmenting (for diagnostics and predictions)
mutate(aug=map(mod,
~augment(.x))) %>%
# Adding standardized residuals
mutate(augstd=map2(aug,mod,
~mutate(.data=.x,
.stdresid=resid(.y,
type="pearson",
scaled=T)))) %>%
# Checking residuals
mutate(diag1=map2(augstd,Location,
~ggplot(data=.x, aes(x=.fitted, y=.stdresid))+
geom_point(aes(color=fRep))+
geom_hline(yintercept = c(-3,0,3), color="orange")+
labs(title=paste0(.y))
))
soyk_reg_all$Anova
soyk_reg_all$diag1
soyk_reg_all %>%
unnest(augstd) %>%
ggplot(aes(x=Krate_kgha, y=K_pct, color=Location))+
geom_point(aes(shape=Location), size=2, alpha=.6)+
#facet_wrap(.~Location)+
geom_line(aes(y=.fixed, linetype=Location), size=1)+
labs(x="K Rate (kg K2O/ha)", y="Plant K (%)")+
theme_solarized_2()+
scale_color_tableau()+
theme(legend.position = "bottom")+
ggsave("../output/Regression.png", width = 5, height = 4)
# Loading packages (everytime you open R)
library(tidyverse) # plotting and wrangling functions
library(readxl) # to read data from an excel file
library(lme4) # for mixed models
library(car) # Anova
library(broom.mixed) # model diagnostics
library(emmeans) # Anova means
library(multcomp) # pairwise comparisons
library(ggthemes) # ggplot customization
soyk_w<- read_excel("../data/SoybeanWorkshopProcessed.xlsx", sheet=1)
# Checking first rows
soyk_w
ggplot(soyk_w, aes(x=Krate_kgha, y=K_pct))+
geom_point(aes(color=Location))+
geom_smooth(method="lm")+
facet_grid(.~Location)
# Loading packages (everytime you open R)
library(tidyverse) # plotting and wrangling functions
library(readxl) # to read data from an excel file
library(lme4) # for mixed models
library(car) # Anova
library(broom.mixed) # model diagnostics
library(emmeans) # Anova means
library(multcomp) # pairwise comparisons
library(ggthemes) # ggplot customization
# Loading packages (everytime you open R)
library(tidyverse) # plotting and wrangling functions
library(readxl) # to read data from an excel file
library(lme4) # for mixed models
library(car) # Anova
library(broom.mixed) # model diagnostics
library(emmeans) # Anova means
library(multcomp) # pairwise comparisons
library(ggthemes) # ggplot customization
soyk_w <- read_excel("../data/SoybeanWorkshopProcessed.xlsx", sheet = 1)
# Checking first rows
soyk_w
names(soyk_w)
ggplot(soyk_w, aes(x=Krate_kgha, y=K_pct))
ggplot(soyk_w, aes(x=Krate_kgha, y=K_pct))+
geom_boxplot()
ggplot(soyk_w, aes(x=factor(Krate_kgha), y=K_pct))+
geom_boxplot()
ggplot(soyk_w, aes(x=factor(Krate_kgha), y=K_pct))+
geom_boxplot(aes(fill=Location))
ggplot(soyk_w, aes(x=factor(Krate_kgha), y=K_pct))+
geom_boxplot(aes(fill=Location))+
facet_grid(.~Location)
# Creating Krate as categorical (factor), transforming other columns to factor, and filtering
soyk_w <- soyk_w %>%
mutate(fKrate_kgha=factor(Krate_kgha),
fRep=factor(Rep),
Location=factor(Location))
soyk_w
# Creating Krate as categorical (factor), transforming other columns to factor, and filtering
soyk_w <- soyk_w %>%
mutate(fKrate_kgha=factor(Krate_kgha),
fRep=factor(Rep),
Location=factor(Location)) %>%
filter(Location!="W1" | fRep!="1")
soyk_w
# Changing type of matrix restriction
options(contrasts = c("contr.sum", "contr.poly"))
# Running model
soyk_mod <- lmer(K_pct ~ Location*fKrate_kgha + (1|Location/fRep),
data = soyk_w)
Anova(soyk_mod, type=3)
# Augmenting
soyk_mod_aug <- augment(soyk_mod)
soyk_mod_aug
# Adding Pearson's standardized residual
soyk_mod_aug$.stdresid <- resid(soyk_mod,
type="pearson",
scaled = T)
names(soyk_mod_aug)
ggplot(soyk_mod_aug, aes(x=.fitted, y=.stdresid))+
geom_point(aes(color=Location))
ggplot(soyk_mod_aug, aes(x=.fitted, y=.stdresid))+
geom_point(aes(color=Location))+
geom_hline(yintercept = c(-3,0,3),color="orange" )
ggplot(soyk_mod_aug, aes(x=.fitted, y=.stdresid))+
geom_point(aes(color=Location))+
geom_hline(yintercept = c(-3,0,3),color="orange" )+
geom_smooth()
soyk_means_LocRate <- emmeans(soyk_mod,
~fKrate_kgha|Location)
soyk_means_LocRate
soyk_means_LocRate <- emmeans(soyk_mod,
~fKrate_kgha:Location)
soyk_means_LocRate
soyk_means_LocRate <- emmeans(soyk_mod,
~fKrate_kgha)
soyk_means_LocRate
soyk_means_LocRate <- emmeans(soyk_mod,
~fKrate_kgha|Location)
soyk_means_LocRate
soyk_pwc_LocRate <- cld(soyk_means_LocRate)
soyk_pwc_LocRate
soyk_pwc_LocRate <- cld(soyk_means_LocRate,
adjust="none",
Letters=letters,
reversed=T)
soyk_pwc_LocRate
soyk_pwc_LocRate
class(soyk_pwc_LocRate)
soyk_pwc_LocRate <- as.data.frame(soyk_pwc_LocRate)
soyk_pwc_LocRate
names(soyk_pwc_LocRate)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location))
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_grid(.~Location)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)
soyk_pwc_LocRate
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group))
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_classic()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_dark()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_economist()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_solarized_2()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_gray()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
theme(legend.position = "none")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
theme(legend.position = "none")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_tableau()+
theme(legend.position = "none")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none")
soyk_pwc_LocRate
levels(soyk_pwc_LocRate)
levels(soyk_pwc_LocRate$Location)
levels(soyk_pwc_LocRate$Location) <- c("a", "b", "c", "d")
levels(soyk_pwc_LocRate$Location)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none")
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none",
panel.grid = element_line(color=NA))
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none",
panel.grid = element_line(color=NA))+
ggsave("../output/Barmeans.png", width = 6, height = 4)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none",
panel.grid = element_line(color=NA))+
ggsave("../output/Barmeans.png", width = 6, height = 10)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none",
panel.grid = element_line(color=NA))+
ggsave("../output/Barmeans.png", width = 6, height = 6)
ggplot(soyk_pwc_LocRate, aes(x=fKrate_kgha, y=emmean))+
geom_bar(aes(fill=Location), stat="identity", alpha=.6, color="black")+
facet_wrap(.~Location)+
geom_text(aes(label=.group), nudge_y = .3)+
labs(y="Plant K (%)", x="K Rate (kg K2O/ha)")+
theme_bw()+
scale_fill_manual(values = c("red", "orange", "blue", "purple"))+
theme(legend.position = "none",
panel.grid = element_line(color=NA))+
ggsave("../output/Barmeans.png", width = 6, height = 6, dpi = 300)
